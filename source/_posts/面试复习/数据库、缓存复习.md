---
title: 数据库、缓存复习
excerpt: 本博客暂不显示摘要，请大家谅解
abbrlink: 85472aa
toc: true
date: 2023-03-11 06:58:16
categories: 期末考试
tags: 期末考试
sticky:
---

## 索引常见八股

数据库索引是一种优化数据库查询性能的技术，被广泛应用于各种数据库管理系统中。以下是关于数据库索引方面的几个常见问题：
索引是什么？索引是一种特殊的文件（InnoDB数据表是表空间文件里的一部分），它包含着对数据库表中一列或多列的引用。主要作用是加快数据的检索速度。
索引的类型有哪些？

- 单列索引：即一个索引只包含单个列。
- 组合索引：索引包含多个列。
- 唯一索引：索引列的值必须唯一，不允许重复。
- 主键索引：特殊的唯一索引，不允许有空值。
- 全文索引：主要用于查找文本中的关键字。
位图索引：适用于列的取值不多的情况。
哈希索引：基于哈希表的实现，对于等值查询性能优异。
索引的原理是什么？大部分数据库使用B树（B-Tree）或者B+树（B+-Tree）作为索引结构，这些数据结构可以帮助数据库高效地读取数据。
索引的优缺点是什么？优点：
加快数据检索速度，提高查询效率。
可以创建唯一性约束，保证数据库表中数据的唯一性。
加速表和表之间的连接。
索引列排序之后可以大大加快数据访问速度。
缺点：
创建和维护索引需要消耗时间，这个时间随着数据量的增加而增加。
索引需要占用磁盘空间。
当对表中的数据进行增加、删除和修改的时候，索引也要动态维护，这样会降低数据的维护速度。
什么时候不该使用索引？
表中数据量小，或者查询表的大部分列。
表经常进行大量的增加、删除、修改操作。
索引列的数据重复率高，不具有唯一性。
如何优化索引？
选择合适的索引列，通常是查询中出现频率高、分布均匀的列。
索引列宜独立：应避免对索引列进行函数操作和计算。
使用索引扫描来代替全表扫描。
控制索引的数量，避免过多索引导致的维护成本高昂问题。
覆盖索引是什么？当一个索引包含所有需要查询的字段的值时，称之为覆盖索引。查询可以直接通过索引获取数据，而无需回表查询，这样可以显著提高查询效率。


## 说一下如何优化索引

当我们讨论优化索引时，通常主要指的是数据库中索引的优化。数据库索引的优化可以显著提高查询效率，降低数据检索的成本。以下是一些常见的索引优化策略：

1. 选择合适的索引列：选择那些经常出现在查询条件（WHERE语句）、排序（ORDER BY）和连接条件（JOIN）中的列作为索引。这样可以加快这些操作的速度。

2. 保持索引精简：仅对必要的列创建索引。过多的索引不仅会占用更多的存储空间，也会减慢写操作的速度，因为索引也需要维护。

3. 使用复合索引：当查询经常涉及多个列时，使用复合索引（一个索引包含多个列）可能更有效。但需要注意列的顺序，通常应将选择性最高的列放在前面。

4. 索引维护：随着数据变更，索引可能会出现碎片化。定期重建或重新组织索引，以确保其保持最优性能。

5. 适当使用前缀索引：如果列的字符串长度很长，使用前缀索引可以减少索引大小，节约存储空间，并可能加快搜索速度。

6. 索引选择性：选择性是指索引中不同值的比例。高选择性的索引意味着有更多唯一值，这类索引的效率更高。

7. 考虑使用包含索引：包含索引允许在非键索引列上存储额外的数据。通过这种方式，某些查询可以直接在索引上得到满足，而不需要通过索引再回表。

8. 监控和分析：定期监控索引的性能，分析索引使用情况和查询计划，找出那些未被充分利用的索引，或者确定是否需要添加新索引。

9. 避免过多的索引动态创建和删除：经常创建和删除索引可能会影响系统性能，并且可能导致查询计划不稳定。

通过这些策略，可以在不同的场景中对索引进行优化。不过，任何优化都需要根据具体情况进行，最好在测试环境中评估优化措施的效果，再在生产环境中实施。


## 索引什么时候失效

索引不会发挥作用，或者说“失效”，通常是在以下情况下：

1. 全表扫描更高效：当查询结果集包含表中的大部分数据时，数据库优化器可能决定使用全表扫描而不是索引扫描。

2. 错误的或没有索引使用：查询中使用的列没有被索引，或者使用的索引对查询不起作用。

3. 索引列参与计算或函数操作：如果WHERE子句中对索引列进行了函数操作，例如 WHERE YEAR(column) = 2021，则索引可能不会被用到。

4. 不符合索引列顺序：在使用复合索引时，如果查询条件不是从索引的最左列开始，索引可能不会被充分利用。

5. 使用了NOT IN 或 <> 操作符：这些操作符往往使数据库优化器难以使用索引。

6. 使用了模糊查询的前置通配符：如 LIKE '%value'，这将阻止索引的使用。

7. 数据类型不一致：在进行列比较时，如果数据类型不匹配，可能导致索引失效。

8. 索引选择性不高：如果索引的列有许多重复值（低选择性），数据库优化器可能认为使用索引效率不足。

9. OR条件下不同列的索引：多个索引条件用OR连接，且参与条件的列分别在不同的索引中，可能导致无法有效使用索引。

10. 隐式转换：当查询条件中的数据类型与表中列的数据类型不一致时，数据库可能会进行隐式转换，这可能导致索引失效。

11. IS NULL 查询：某些数据库不会对 IS NULL 条件使用索引。

12. 排序规则和字符集问题：如果索引列的排序规则（collation）或字符集与查询中使用的不一致，也可能导致索引失效。

每种数据库系统的优化器行为略有不同，因此上述情况并非适用于所有数据库系统，具体情况需根据实际使用的数据库系统进行考虑。当索引失效时，可以通过查询优化、修改数据库模式或重新设计索引来解决这些问题。在实际管理数据库时，了解这些情况对于有效利用索引至关重要。